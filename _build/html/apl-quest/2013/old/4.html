
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Keeping Things In Balance &#8212; APL Quest Notes</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=2f532779" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'apl-quest/2013/old/4';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">APL Quest Notes</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/apl-quest/2013/old/4.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1> Keeping Things In Balance</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="keeping-things-in-balance">
<h1><a class="reference external" href="https://problems.tryapl.org/psets/2013.html?goto=P4_Keeping_Things_In_Balance"> Keeping Things In Balance</a><a class="headerlink" href="#keeping-things-in-balance" title="Link to this heading">#</a></h1>
<p><strong>Problem:</strong> Write an APL dfn which returns a 1 if the opening and closing parentheses in a character vector are balanced, or a zero otherwise.</p>
<p><strong>Video:</strong> <a class="reference external" href="https://youtu.be/El0_RB4TTPA">https://youtu.be/El0_RB4TTPA</a>
<strong>Code:</strong> <a class="github reference external" href="https://github.com/abrudz/apl_quest/blob/main/2013/4.apl">abrudz/apl_quest</a></p>
<p><strong>Example Solutions:</strong></p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w">	</span><span class="nv">Di</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">1</span><span class="w"> </span><span class="m">¯1</span><span class="w"> </span><span class="m">0</span><span class="sr">[</span><span class="s1">&#39;()&#39;</span><span class="o">⍳</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span><span class="w"> </span><span class="c1">⍝ Indexing into an array, 1 is left paren, ¯1 is Right and 0 is all other characters. </span>
<span class="w">	</span><span class="nv">Df</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;(&#39;</span><span class="na">∘</span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">=</span><span class="na">∘</span><span class="s1">&#39;)&#39;</span><span class="w"> </span><span class="c1">⍝ Tacit, subtracts the comparisons to get the depth changes. </span>
<span class="w">	</span><span class="nv">Bn</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">¯1</span><span class="o">∊+</span><span class="na">\</span><span class="p">)</span><span class="o">⍱</span><span class="m">0</span><span class="o">≠+</span><span class="na">/</span><span class="w"> </span><span class="c1">⍝ checks for no ¯1 and no 0 in scan</span>
<span class="w">	</span><span class="nv">F</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">¯1</span><span class="na">∘</span><span class="o">∊⍱</span><span class="m">0</span><span class="o">≠⊢</span><span class="na">/</span><span class="p">)</span><span class="s1">&#39;(&#39;</span><span class="na">∘</span><span class="o">=+</span><span class="na">\⍤</span><span class="o">-=</span><span class="na">∘</span><span class="s1">&#39;)&#39;</span><span class="w"> </span><span class="c1">⍝ Moves scan to be atop on comparisons +\⍤ </span>
<span class="w">	</span><span class="err">```</span>

<span class="o">**</span><span class="nv">Parenthesis</span><span class="w"> </span><span class="nv">depth</span><span class="w"> </span><span class="nv">changes</span><span class="o">**</span>
<span class="nv">Examples</span><span class="bp">:</span>
<span class="err">```</span><span class="nv">APL</span>
<span class="nv">Di</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍵</span><span class="w"> </span><span class="o">↑</span><span class="na">⍤</span><span class="o">,</span><span class="na">⍥</span><span class="o">⊂</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">¯1</span><span class="w"> </span><span class="m">0</span><span class="sr">[</span><span class="s1">&#39;()&#39;</span><span class="o">⍳</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span><span class="w"> </span><span class="c1">⍝ Convert the data to norrmalized form. </span>
<span class="nv">Do</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">-</span><span class="na">⌿</span><span class="s1">&#39;()&#39;</span><span class="na">∘.</span><span class="o">=⊢</span>
<span class="nv">Df</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;(&#39;</span><span class="na">∘</span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">=</span><span class="na">∘</span><span class="s1">&#39;)&#39;</span>
</pre></div>
</div>
<p><strong>Di</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">['()'⍳⍵]</span></code> - <a class="reference external" href="https://aplwiki.com/wiki/Index_Of">Index of</a> <code class="docutils literal notranslate"><span class="pre">⍳</span></code> shows a 1 if left paren, 2 if right paren, and 3 if not found.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">¯1</span> <span class="pre">0</span></code> - map the result of step 1  to (1 left,  -1 right, 0 not found)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">↑⍤,⍥⊂</span></code> -  <a class="reference external" href="https://aplwiki.com/wiki/Enclose">Enclose</a> <code class="docutils literal notranslate"><span class="pre">⊂</span></code>  - Create a nested scaler  <a class="reference external" href="https://aplwiki.com/wiki/Over">Over</a>  <code class="docutils literal notranslate"><span class="pre">⍥</span></code> -  Preprocess the right argument  <a class="reference external" href="https://aplwiki.com/wiki/Rank_(operator)#Merge_axes">Merge Axis</a> -  <code class="docutils literal notranslate"><span class="pre">⍤,</span></code> concatenate the two axis  <a class="reference external" href="https://aplwiki.com/wiki/Mix">Mix</a>  <code class="docutils literal notranslate"><span class="pre">↑</span></code> - trades one level of <a class="reference external" href="https://aplwiki.com/wiki/Depth">depth</a> (nesting) into one level of <a class="reference external" href="https://aplwiki.com/wiki/Rank">rank</a>.</p></li>
</ol>
<p><strong>Do</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'()'∘.=⊢</span></code> Applying an <a class="reference external" href="https://mastering.dyalog.com/Operators.html?highlight=outer%20product#outer-product">Outer Product</a> using a comparison <code class="docutils literal notranslate"><span class="pre">=</span></code> Because this is a tacit function <a class="reference external" href="https://aplwiki.com/wiki/Identity">Right Tack</a> acts as omega <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and just returns the function it is pointing to.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'()'∘.=⊢</span></code> The <code class="docutils literal notranslate"><span class="pre">'()'</span></code> is the comparison that the outer product is applying against the identity. This creates a table.</p></li>
<li><p>The first row a <a class="reference external" href="https://aplwiki.com/wiki/Boolean">Boolean Mask</a> of 1’s (true) where the left parenthesis is found and 0 (false) where is it not found.</p></li>
<li><p>The second row is 1’s where the right parenthesis is found.</p></li>
<li><p>The result of step 2 is already a matrix. So we can use <a class="reference external" href="https://xpqz.github.io/cultivations/Functions7.html#table">Table</a> <code class="docutils literal notranslate"><span class="pre">⍪</span></code>  - to ravel the major cells of the array and make each one of them into a row with the identity on top. This is just explanatory.</p></li>
<li><p>-⌿ Subtracting the bottom row from step 2 from the top row in step 2 using a vertical minus <a class="reference external" href="https://aplwiki.com/wiki/Reduce">Reduction</a> gives us the  depth changes.</p></li>
</ol>
<p><strong>Df</strong></p>
<ol class="arabic simple">
<li><p>We can do the two <a class="reference external" href="https://aplwiki.com/wiki/Comparison_function">Comparison Functions</a> independently</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'('∘=</span></code> Making a boolean mask of the left parenthesis.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">=∘')'</span></code> Making a boolean mask of the right parenthesis.</p></li>
<li><p>After subtracting the two results to give us the depth changes we can turn this into a <a class="reference external" href="https://aplwiki.com/wiki/Tacit_programming">Tacit Function</a></p></li>
<li><p><a class="reference external" href="https://aplwiki.com/wiki/Bind">Bind</a> <code class="docutils literal notranslate"><span class="pre">∘</span></code> is used to create a derived function with a single constant argument for each comparison.</p></li>
<li><p>This creates a <a class="reference external" href="https://aplwiki.com/wiki/Train#3-trains">3-train Fork</a> where the two outer functions are applied first, and their results are used as arguments to the middle function in this case subtract <code class="docutils literal notranslate"><span class="pre">-</span></code>.</p></li>
</ol>
<p><strong>Performance</strong>
Examples:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;turtle&#39;</span><span class="w"> </span><span class="s1">&#39;joy&#39;</span><span class="w"> </span><span class="s1">&#39;cmpx&#39;</span><span class="nf">⎕cy</span><span class="s1">&#39;dfns&#39;</span>
<span class="p">(</span><span class="nv">y</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span><span class="kd">←</span><span class="p">(</span><span class="o">⊢⍴</span><span class="na">⍨</span><span class="m">100</span><span class="o">×⍴</span><span class="p">)</span><span class="na">⍤</span><span class="nf">⎕VR</span><span class="na">¨</span><span class="s1">&#39;turtle&#39;</span><span class="w"> </span><span class="s1">&#39;joy&#39;</span>
<span class="nv">cmpx</span><span class="s1">&#39;D&#39;</span><span class="o">,</span><span class="na">¨</span><span class="s1">&#39;iof&#39;</span><span class="o">,</span><span class="na">¨</span><span class="o">⊂</span><span class="s1">&#39; y&#39;</span>
</pre></div>
</div>
<p>We can evalute the performance of each function by importing the <a class="reference external" href="http://dfns.dyalog.com/n_cmpx.htm">CMPX</a> function from the <a class="reference external" href="http://dfns.dyalog.com/n_contents.htm">DFNS</a> library.</p>
<ol class="arabic simple">
<li><p>We can  <a class="reference external" href="http://help.dyalog.com/latest/Content/Language/System%20Functions/cy.htm">copy</a> <code class="docutils literal notranslate"><span class="pre">⎕cy</span></code> CMPX  along with TURTLE and JOY from the DFNS library into our workspace.</p></li>
<li><p>We know that Turtle has matched parenthesis and Joy has unmatched parenthesis so we can use these two functions as our test cases.</p></li>
<li><p>In the next line we are taking the <a class="reference external" href="https://xpqz.github.io/cultivations/CodeManagement.html?highlight=vr#visual-representation-vr">Vector Representation</a> - ⎕VR of <a class="reference external" href="https://aplwiki.com/wiki/Each">Each</a> <code class="docutils literal notranslate"><span class="pre">¨</span></code> function.</p></li>
<li><p><a class="reference external" href="https://aplwiki.com/wiki/Rank_(operator)">Rank</a> <code class="docutils literal notranslate"><span class="pre">⍤</span></code> - applies its left [operand](. <a class="reference external" href="https://aplwiki.com/wiki/Operand">https://aplwiki.com/wiki/Operand</a> “Operand”) function to <a class="reference external" href="https://aplwiki.com/wiki/Cells" title="Cells">cells</a> of its arguments specified by its right operand array.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⊢⍴⍨100×⍴</span></code> Using <a class="reference external" href="https://aplwiki.com/wiki/Commute">Commute</a> <code class="docutils literal notranslate"><span class="pre">⍨</span></code>  - we first take the <a class="reference external" href="https://aplwiki.com/wiki/Shape">Shape</a> of the idenitity <code class="docutils literal notranslate"><span class="pre">⊢⍴</span></code> and and then  <a class="reference external" href="https://aplwiki.com/wiki/Reshape">Reshape</a> <code class="docutils literal notranslate"><span class="pre">100×⍴</span></code> it using 100 times it’s current shape.</p></li>
<li><p>In the next line we are doing some meta programming to use cmpx to evalute the performance of each function.</p></li>
<li><p>Every function begins with a D. We <a class="reference external" href="https://aplwiki.com/wiki/Catenate">Concatenate</a>  <a class="reference external" href="https://aplwiki.com/wiki/Each">Each</a> <code class="docutils literal notranslate"><span class="pre">,¨</span></code> of the suffixes ‘iof’ and then  <a class="reference external" href="https://aplwiki.com/wiki/Catenate">Concatenate</a>  <a class="reference external" href="https://aplwiki.com/wiki/Each">Each</a> <code class="docutils literal notranslate"><span class="pre">,¨</span></code> to the entire function ‘ y’ using <a class="reference external" href="https://aplwiki.com/wiki/Enclose">Enclose</a> <code class="docutils literal notranslate"><span class="pre">⊂</span></code> - An enclosed array is a <a class="reference external" href="https://aplwiki.com/wiki/Scalar" title="Scalar">scalar</a>, which is subject to <a class="reference external" href="https://aplwiki.com/wiki/Scalar_extension" title="Scalar extension">scalar extension</a>.</p></li>
</ol>
<p><strong>Balanced?</strong>
Comment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">We</span> <span class="n">are</span> <span class="n">checking</span> <span class="k">if</span> <span class="n">two</span> <span class="n">condtions</span> <span class="n">are</span> <span class="n">realized</span><span class="o">.</span> 
<span class="mf">1.</span> <span class="n">Our</span> <span class="n">final</span> <span class="n">parenthesis</span> <span class="n">level</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">be</span> <span class="n">zero</span><span class="o">.</span> 
<span class="mf">2.</span> <span class="n">As</span> <span class="n">our</span> <span class="n">function</span> <span class="n">proceeds</span> <span class="n">our</span> <span class="n">parenthesis</span> <span class="n">level</span> <span class="n">should</span> <span class="ow">not</span> <span class="n">drop</span> <span class="n">below</span> <span class="n">zero</span><span class="o">.</span> 
<span class="mf">3.</span> <span class="n">Both</span> <span class="n">expressions</span> <span class="n">are</span> <span class="n">then</span> <span class="n">evaluted</span> <span class="k">for</span> <span class="n">performance</span> <span class="n">using</span> <span class="n">simlar</span> <span class="n">steps</span> <span class="n">to</span> <span class="n">above</span>
</pre></div>
</div>
<p>Examples:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Ba</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">∧</span><span class="na">/</span><span class="m">0</span><span class="o">≤+</span><span class="na">\</span><span class="p">)</span><span class="o">∧</span><span class="m">0</span><span class="o">=+</span><span class="na">/</span>
<span class="nv">Bn</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">¯1</span><span class="o">∊+</span><span class="na">\</span><span class="p">)</span><span class="o">⍱</span><span class="m">0</span><span class="o">≠+</span><span class="na">/</span>
<span class="nv">Bns</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">¯1</span><span class="na">∘</span><span class="o">∊⍱</span><span class="m">0</span><span class="o">≠⊢</span><span class="na">/</span><span class="p">)</span><span class="o">+</span><span class="na">\</span>
<span class="nv">F</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">¯1</span><span class="na">∘</span><span class="o">∊⍱</span><span class="m">0</span><span class="o">≠⊢</span><span class="na">/</span><span class="p">)</span><span class="s1">&#39;(&#39;</span><span class="na">∘</span><span class="o">=+</span><span class="na">\⍤</span><span class="o">-=</span><span class="na">∘</span><span class="s1">&#39;)&#39;</span>
</pre></div>
</div>
<p>BA</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">∧/</span></code> <a class="reference external" href="https://aplwiki.com/wiki/And">And</a> <a class="reference external" href="https://aplwiki.com/wiki/Reduction" title="Reduction">Reduction</a>  tests if it is true for ALL that the parenthesis depth is greater than or equal to zero.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0≤+\</span></code> Plus <a class="reference external" href="https://aplwiki.com/wiki/Scan">Scan</a> <code class="docutils literal notranslate"><span class="pre">+\</span></code> gives us the parenthesis depth. The <a class="reference external" href="https://aplwiki.com/wiki/Comparison_function">Comparison Function</a> <code class="docutils literal notranslate"><span class="pre">0≤</span></code> checks if zero is less than or equal to the running sum.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">∧0=+/</span></code> <a class="reference external" href="https://aplwiki.com/wiki/And">And</a>  also checking if it is true that zero = the full sum <code class="docutils literal notranslate"><span class="pre">0=+/</span></code>.</p></li>
<li><p>Both conditions must be true for BA to return 1 (for true).</p></li>
</ol>
<p>BN</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">¯1∊+\</span></code> Checks if -1 is a <a class="reference external" href="https://aplwiki.com/wiki/Membership">member</a> <code class="docutils literal notranslate"><span class="pre">∊</span></code> of the running sum or <a class="reference external" href="https://aplwiki.com/wiki/Scan">Scan</a> <code class="docutils literal notranslate"><span class="pre">+\</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0≠+/</span></code> Checks if zero is not equal to the total.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⍱</span></code> <a class="reference external" href="https://aplwiki.com/wiki/Nor">Nor</a> tests if neither argument (Step 1 or 2) is true: it returns 1 if both are false (0) and 0 if at least one is true (1)</p></li>
</ol>
<p>BNS</p>
<ol class="arabic simple">
<li><p>Move the Scan to outside the parenthesis</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">∘</span></code> <a class="reference external" href="https://aplwiki.com/wiki/Bind">Bind</a> the enclose to the scaler. Tacit so the identity element is implied.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⊢/</span></code> Right Reduction picks the last element of the Scan we moved in step 1.</p></li>
<li><p>Evaluate for performance.</p></li>
</ol>
<p>F</p>
<ol class="arabic simple">
<li><p>Take our BNS solution which is an <a class="reference external" href="https://aplwiki.com/wiki/Train#2-trains">Atop</a> or 2-train. The left function is applied <a class="reference external" href="https://aplwiki.com/wiki/Monadic_function" title="Monadic function">monadically</a> on the result of the right function.</p></li>
<li><p>Take our Df Solution which is a <a class="reference external" href="https://aplwiki.com/wiki/Train#3-trains">Fork</a> or 3-Train. The two outer functions are applied first, and their results are used as arguments to the middle function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">+\⍤-</span></code> To combine these solutions we use an <a class="reference external" href="https://aplwiki.com/wiki/Atop_(operator)">Atop</a> <code class="docutils literal notranslate"><span class="pre">⍤</span></code> operator  on Df to post process the result of the subtraction using a scan <code class="docutils literal notranslate"><span class="pre">+\</span></code>.</p></li>
<li><p>The depth change in Step 3 is then passed to BNS.</p></li>
</ol>
<p><strong>Find and Replace</strong> - Regular Expressions
Comment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Find</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">parenthesis</span> <span class="ow">and</span> <span class="n">eliminate</span> <span class="n">pairs</span> <span class="n">of</span> <span class="n">parenthesis</span> <span class="n">until</span> <span class="n">none</span> <span class="n">are</span> <span class="n">found</span><span class="o">.</span> 
<span class="n">If</span> <span class="n">we</span> <span class="n">have</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">set</span> <span class="n">Parenthesis</span> <span class="n">are</span> <span class="n">matched</span><span class="o">.</span>
<span class="n">Any</span> <span class="n">parenthesis</span> <span class="n">that</span> <span class="n">are</span> <span class="n">left</span> <span class="n">means</span> <span class="n">they</span> <span class="n">are</span> <span class="n">unbalanced</span><span class="o">.</span>
</pre></div>
</div>
<p>Examples:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">t</span><span class="kd">←</span><span class="s1">&#39;(1 2)×(3+(3÷4))×(1+2)÷8&#39;</span>
<span class="nv">Re</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="o">≡</span><span class="s1">&#39;\(\)&#39;</span><span class="nf">⎕R</span><span class="s1">&#39;&#39;</span><span class="na">⍣</span><span class="o">≡</span><span class="na">⍤</span><span class="o">∩</span><span class="na">∘</span><span class="s1">&#39;()&#39;</span>
<span class="nv">Re0</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="o">≡</span><span class="s1">&#39;()&#39;</span><span class="nf">⎕R</span><span class="s1">&#39;&#39;</span><span class="na">⍠</span><span class="s1">&#39;Regex&#39;</span><span class="m">0</span><span class="na">⍣</span><span class="o">≡</span><span class="na">⍤</span><span class="o">∩</span><span class="na">∘</span><span class="s1">&#39;()&#39;</span>
<span class="nv">Fi</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="o">≡</span><span class="p">(</span><span class="o">⊢</span><span class="p">(</span><span class="na">/⍨</span><span class="p">)</span><span class="m">¯1</span><span class="p">(</span><span class="o">⊢⍱⌽</span><span class="p">)</span><span class="s1">&#39;()&#39;</span><span class="na">∘</span><span class="o">⍷</span><span class="p">)</span><span class="na">⍣</span><span class="o">≡</span><span class="na">⍤</span><span class="o">∩</span><span class="na">∘</span><span class="s1">&#39;()&#39;</span>
</pre></div>
</div>
<p>RE</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">∩∘'()'</span></code> <a class="reference external" href="https://aplwiki.com/wiki/Intersection">Intersection</a> <code class="docutils literal notranslate"><span class="pre">∩</span></code> removes elements from the left which are not present in the right. In this case we remove everything but the parenthesis.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'\(\)'⎕R''</span></code> <a class="reference external" href="https://xpqz.github.io/cultivations/Regex.html?highlight=regular%20expressions">Regular Expression</a> using <code class="docutils literal notranslate"><span class="pre">⎕R</span></code> to find parenthesis and replace with an empty string. Each parenthesis is escaped using <code class="docutils literal notranslate"><span class="pre">\</span></code> Performs this operation one time.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">''≡</span></code> <a class="reference external" href="https://aplwiki.com/wiki/match">Match</a> <code class="docutils literal notranslate"><span class="pre">≡</span></code> is checking if the result matches an empty string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⍣≡</span></code>  <a class="reference external" href="https://xpqz.github.io/cultivations/ConditionControlledLoops.html?highlight=power">Power Match</a>  <code class="docutils literal notranslate"><span class="pre">⍣≡</span></code> - Iterating until a fixed point is reached. In this case when no more parens are found.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⍤</span></code> <a class="reference external" href="https://aplwiki.com/wiki/Atop_(operator)">Atop Operator</a> takes the two monadic functions and glues them together.</p></li>
</ol>
<p>RE0</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://aplwiki.com/wiki/Variant">Variant</a> <code class="docutils literal notranslate"><span class="pre">⍠</span></code> - Switch Regex to plain text using <code class="docutils literal notranslate"><span class="pre">'Regex'0</span></code></p></li>
<li><p>This allows us to use <code class="docutils literal notranslate"><span class="pre">⎕R</span></code> to search and replace parenthesis without escaping them</p></li>
<li><p>The same function is then applied.</p></li>
</ol>
<p>FI</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">⍣≡⍤∩∘'()'</span></code> Step 1,4,5 from RE</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'()'∘⍷</span></code> Using the <a class="reference external" href="https://aplwiki.com/wiki/find">Find</a> <code class="docutils literal notranslate"><span class="pre">⍷</span></code> function returns a boolean mask where 1 indicates the start of an set of open and closed parens.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">¯1(⊢⍱⌽)</span></code>  Takes the [mask](<a class="reference external" href="https://aplwiki.com/wiki/Boolean">Boolean Mask</a>) generated in Step 2 <code class="docutils literal notranslate"><span class="pre">⊢</span></code> and <a class="reference external" href="https://mastering.dyalog.com/Working-on-Data-Shape.html?highlight=rotate#rotate-vectors">Rotates</a> <code class="docutils literal notranslate"><span class="pre">⌽</span></code> it one step <code class="docutils literal notranslate"><span class="pre">¯1</span></code>.  This indicates where the closed parens are.  We want to remove parens with the mask so we are using  <a class="reference external" href="https://aplwiki.com/wiki/Nor">Nor</a> <code class="docutils literal notranslate"><span class="pre">⍱</span></code>. To retain parens we would use <a class="reference external" href="https://aplwiki.com/wiki/Or">Or</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⊢(/⍨)</span></code>  Use the result of Step 3 to <a class="reference external" href="https://en.wikipedia.org/wiki/filter_(higher-order_function)" title="wikipedia:filter (higher-order function)">Filter</a>  the string <strong>t</strong> using <a class="reference external" href="https://aplwiki.com/wiki/Replicate">Compress</a> <code class="docutils literal notranslate"><span class="pre">/</span></code> We use <a class="reference external" href="https://aplwiki.com/wiki/Commute">Commute</a> <code class="docutils literal notranslate"><span class="pre">⍨</span></code>  and the <a class="reference external" href="https://aplwiki.com/wiki/Identity">Identity</a> <code class="docutils literal notranslate"><span class="pre">⊢</span></code> to maintain right to left evaluation becuase this expression is <a class="reference external" href="https://aplwiki.com/wiki/Tacit_programming">Tacit</a>.  This will be more clear if we look at the Dfn version generated by <a class="reference external" href="https://tacit.help/">tacit.help</a></p></li>
</ol>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Fi</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="s1">&#39;&#39;</span><span class="o">≡</span><span class="p">((</span><span class="kt">{</span><span class="p">((</span><span class="s1">&#39;()&#39;</span><span class="o">⍷</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⍱</span><span class="p">(</span><span class="m">¯1</span><span class="o">⌽</span><span class="p">(</span><span class="s1">&#39;()&#39;</span><span class="o">⍷</span><span class="bp">⍵</span><span class="p">)))</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍣</span><span class="o">≡</span><span class="p">)(</span><span class="bp">⍵</span><span class="o">∩</span><span class="s1">&#39;()&#39;</span><span class="p">))</span><span class="kt">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p><code class="docutils literal notranslate"><span class="pre">''≡</span></code>  Step 3 from RE</p></li>
</ol>
<p><strong>Abusing APL’s Parser</strong>
Comment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">APL</span> <span class="n">interpreter</span> <span class="n">can</span> <span class="n">parse</span> <span class="n">paired</span> <span class="ow">and</span> <span class="n">unpaired</span> <span class="n">parenthesis</span> <span class="ow">and</span> <span class="n">braces</span> <span class="ow">and</span> <span class="n">will</span> <span class="k">return</span> <span class="n">an</span> <span class="n">error</span> <span class="k">if</span> <span class="n">unpaired</span><span class="o">.</span> <span class="n">We</span> <span class="n">can</span> <span class="n">use</span> <span class="n">this</span> <span class="ow">in</span> <span class="n">our</span> <span class="n">expressions</span><span class="o">.</span>  
</pre></div>
</div>
<p>Examples</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">t</span><span class="kd">←</span><span class="s1">&#39;(1 2)×(3+(3÷4))×(1+2)÷8&#39;</span>
<span class="nv">Nd</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">0</span><span class="bp">::</span><span class="m">0</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="p">(</span><span class="o">⍎</span><span class="s1">&#39;{} &#39;</span><span class="sr">[</span><span class="s1">&#39;()&#39;</span><span class="o">⍳</span><span class="bp">⍵</span><span class="sr">]</span><span class="p">)</span><span class="na">/</span><span class="m">1</span><span class="kt">}</span>
<span class="nv">Np</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">0</span><span class="bp">::</span><span class="m">0</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="o">⊃∊⍎⍕</span><span class="m">1</span><span class="o">,</span><span class="m">1</span><span class="o">,</span><span class="na">¨</span><span class="bp">⍵</span><span class="o">∩</span><span class="s1">&#39;()&#39;</span><span class="kt">}</span>
</pre></div>
</div>
<p>ND</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">⍎'{}</span> <span class="pre">'['()'⍳t]</span></code>  This is the same process as Step 1 of Di. We are getting the <a class="reference external" href="https://aplwiki.com/wiki/Index_Of">Index of</a> <code class="docutils literal notranslate"><span class="pre">⍳</span></code> our string <strong>t</strong> and then <a class="reference external" href="https://xpqz.github.io/learnapl/indexing.html#bracket-indexing">Mapping</a>  the result to open and closed brace <code class="docutils literal notranslate"><span class="pre">{}</span></code> and a blank space.  We then <a class="reference external" href="https://aplwiki.com/wiki/execute">Execute</a> ⍎ this function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/1</span></code>  <a class="reference external" href="https://aplwiki.com/wiki/Reduction" title="Reduction">Reduction</a> <code class="docutils literal notranslate"><span class="pre">/</span></code> over a scaler. Applying a function to a scaler doesn’t change the function and will let APL evaluate it. It will return the 1 if it does not error.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0::0⋄</span></code>  <a class="reference external" href="https://help.dyalog.com/latest/#Language/Defined%20Functions%20and%20Operators/DynamicFunctions/Error%20Guards.htm#ErrorGuards">Error Guard</a> <code class="docutils literal notranslate"><span class="pre">::</span></code> Error numbers 0 and 1000 are catch-alls for synchronous errors and interrupts respectively. <a class="reference external" href="https://aplwiki.com/wiki/Statement_separator">Diamond</a> <code class="docutils literal notranslate"><span class="pre">⋄</span></code> is a statement Seperator. If the expression from Step 1 and 2 generates an error, its immediately preceding: <code class="docutils literal notranslate"><span class="pre">0::0</span></code> catches it and returns 0.</p></li>
<li><p>Evaluted on the <a class="reference external" href="https://xpqz.github.io/cultivations/CodeManagement.html?highlight=vr#visual-representation-vr">Vector Representation</a> - ⎕VR of two Dfns ‘turtle’ and ‘joy’.</p></li>
</ol>
<p>NP</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1,1,¨t∩'()'</span></code> We evaulate the set <a class="reference external" href="https://aplwiki.com/wiki/Intersection">Intersection</a>  <code class="docutils literal notranslate"><span class="pre">∩</span></code> of our string against open and closed parens <code class="docutils literal notranslate"><span class="pre">()</span></code> Then we <a class="reference external" href="https://aplwiki.com/wiki/Catenate">Concatenate</a> a 1 in front of  <a class="reference external" href="https://aplwiki.com/wiki/Each">Each</a> <code class="docutils literal notranslate"><span class="pre">1,¨</span></code> character. Then we concatenate a 1 in front of the entire expression.  <code class="docutils literal notranslate"><span class="pre">1,</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⊃∊⍎⍕</span></code> We then <a class="reference external" href="https://mastering.dyalog.com/Execute-and-Format-Control.html#the-format-primitive">Format</a> ⍕  the result into a character array. Numeric and nested arrays are converted into vectors or matrices of characters and <a class="reference external" href="https://aplwiki.com/wiki/execute">Execute</a> ⍎ it. <a class="reference external" href="https://xpqz.github.io/learnapl/manip.html?highlight=enlist#ravel-catenate-enlist-member">Flattening</a> <code class="docutils literal notranslate"><span class="pre">∊</span></code> any nested arrays and <a class="reference external" href="https://aplwiki.com/wiki/first">Picking</a> ⊃ the first element which should be the 1 we concatenated to the front in Step 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0::0⋄</span></code> we use the same Error Guard as in Step 3 of ND to check for unpaired parenthesis.</p></li>
</ol>
<p><strong>Glyphs Used:</strong>
<a class="reference external" href="https://aplwiki.com/wiki/Index_Of">Index of</a> <code class="docutils literal notranslate"><span class="pre">⍳</span></code>
<a class="reference external" href="https://xpqz.github.io/learnapl/indexing.html#bracket-indexing">Bracket Indexing</a>  [ ]  - Mapping
<a class="reference external" href="https://aplwiki.com/wiki/Mix">Mix</a>  <code class="docutils literal notranslate"><span class="pre">↑</span></code>
<a class="reference external" href="https://aplwiki.com/wiki/Rank_(operator)#Merge_axes">Merge Axis</a>  ,⍤
<a class="reference external" href="https://aplwiki.com/wiki/Over">Over</a>  <code class="docutils literal notranslate"><span class="pre">⍥</span></code>
<a class="reference external" href="https://aplwiki.com/wiki/Enclose">Enclose</a> <code class="docutils literal notranslate"><span class="pre">⊂</span></code> - creates a nested scalar by wrapping its argument under one level of nesting
<a class="reference external" href="https://aplwiki.com/wiki/Outer_Product">Outer Product</a> <code class="docutils literal notranslate"><span class="pre">∘.</span></code>  - using a comparison <code class="docutils literal notranslate"><span class="pre">∘.=</span></code>
<a class="reference external" href="https://aplwiki.com/wiki/Catenate">Laminate</a>  <code class="docutils literal notranslate"><span class="pre">⍪</span></code> Catenate First - Add a line to a matrix
<a class="reference external" href="https://aplwiki.com/wiki/Reduce">Reduce</a> <code class="docutils literal notranslate"><span class="pre">⌿</span></code> Vertical Minus Reduction
<a class="reference external" href="https://aplwiki.com/wiki/Bind">Bind</a> <code class="docutils literal notranslate"><span class="pre">∘</span></code>
<a class="reference external" href="https://xpqz.github.io/cultivations/CodeManagement.html?highlight=vr#visual-representation-vr">Vector Representation</a> - ⎕VR<code class="docutils literal notranslate"><span class="pre">[Rank](https://aplwiki.com/wiki/Rank_(operator))</span> </code>⍤<code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">applies</span> <span class="pre">its</span> <span class="pre">left</span> <span class="pre">operand</span> <span class="pre">function</span> <span class="pre">to</span> <span class="pre">cells</span> <span class="pre">of</span> <span class="pre">its</span> <span class="pre">arguments</span> <span class="pre">specified</span> <span class="pre">by</span> <span class="pre">its</span> <span class="pre">right</span> <span class="pre">operand</span> <span class="pre">array.</span>&#160; <span class="pre">[Identity](https://aplwiki.com/wiki/Identity)</span></code>⊢<code class="docutils literal notranslate"><span class="pre">[Reshape](https://aplwiki.com/wiki/Reshape)</span></code>⍴<code class="docutils literal notranslate"><span class="pre">[Commute](https://aplwiki.com/wiki/Commute)</span></code>⍨<code class="docutils literal notranslate"> <span class="pre">-</span> <span class="pre">aka</span> <span class="pre">Selfie</span> <span class="pre">or</span> <span class="pre">Swap</span> <span class="pre">[Tally](https://aplwiki.com/wiki/Tally)</span></code>≢<code class="docutils literal notranslate"><span class="pre">[Each](https://aplwiki.com/wiki/Each)</span></code>¨<code class="docutils literal notranslate"><span class="pre">[Scan](https://aplwiki.com/wiki/Scan)</span></code>+`  - Plus Scan
<a class="reference external" href="https://aplwiki.com/wiki/Add#Reduction">Sum</a> <code class="docutils literal notranslate"><span class="pre">+/</span></code> - <a class="reference external" href="https://aplwiki.com/wiki/Reduction" title="Reduction">Reduction</a> with Add gives the sum of the whole list.
<a class="reference external" href="https://aplwiki.com/wiki/And">And</a> <code class="docutils literal notranslate"><span class="pre">∧</span></code> - tests if both arguments are true: it returns 1 if both are true (1) and 0 if one or both are false (0)
<a class="reference external" href="https://aplwiki.com/wiki/Nor">Nor</a> <code class="docutils literal notranslate"><span class="pre">⍱</span></code> - tests if neither argument is true: it returns 1 if both are false (0) and 0 if at least one is true (1)
<a class="reference external" href="https://aplwiki.com/wiki/Enlist">Enlist</a>  <code class="docutils literal notranslate"><span class="pre">∊</span></code> - Enlist flattens over all layers of nesting
<a class="reference external" href="https://aplwiki.com/wiki/Intersection">Intersection</a>  <code class="docutils literal notranslate"><span class="pre">∩</span></code>
<a class="reference external" href="https://aplwiki.com/wiki/match">Match</a> <code class="docutils literal notranslate"><span class="pre">≡</span></code>
<a class="reference external" href="https://aplwiki.com/wiki/Power_(operator)">Power Match</a>  <code class="docutils literal notranslate"><span class="pre">⍣≡</span></code> - Iterating until a fixed point is reached.
<a class="reference external" href="https://aplwiki.com/wiki/Atop_(operator)">Atop</a> <code class="docutils literal notranslate"><span class="pre">⍤</span></code> - takes two (monadic) functions and glues them together.  Uses the left operand to process the right</p>
<p><mark style="background: #BBFABBA6;">Regular Expressions</mark>
<a class="reference external" href="https://aplwiki.com/wiki/Variant">Variant</a> <code class="docutils literal notranslate"><span class="pre">⍠</span></code> - Switch Regex to plain text
<a class="reference external" href="https://aplwiki.com/wiki/find">Find</a> <code class="docutils literal notranslate"><span class="pre">⍷</span></code>
<a class="reference external" href="https://aplwiki.com/wiki/rotate">Rotate</a> <code class="docutils literal notranslate"><span class="pre">⌽</span></code>
<a class="reference external" href="https://aplwiki.com/wiki/or">Or</a> <code class="docutils literal notranslate"><span class="pre">∨</span></code>
<a class="reference external" href="https://aplwiki.com/wiki/Replicate">Compress</a> <code class="docutils literal notranslate"><span class="pre">/</span></code> -  Outside of APL, <a class="reference external" href="https://en.wikipedia.org/wiki/filter_(higher-order_function)" title="wikipedia:filter (higher-order function)">filter</a> typically provides the functionality of Compress
<a class="reference external" href="https://aplwiki.com/wiki/execute">Execute</a> ⍎
<a class="reference external" href="https://aplwiki.com/wiki/Statement_separator">Diamond</a> ⋄ - Statement Seperator
<a class="reference external" href="https://aplwiki.com/wiki/format">Format</a> ⍕ - Flatten
<a class="reference external" href="https://aplwiki.com/wiki/first">First</a> ⊃</p>
<p><strong>Concepts Used:</strong>
<a class="reference external" href="https://aplwiki.com/wiki/Comparison_function">Comparison Function</a>
<a class="reference external" href="https://aplwiki.com/wiki/Dfn">Dfn</a>
<a class="reference external" href="https://aplwiki.com/wiki/Tacit_programming">Tacit Programming</a>
<a class="reference external" href="https://aplwiki.com/wiki/Boolean">Boolean Mask</a>
<a class="reference external" href="https://aplwiki.com/wiki/Reduce">Reduction</a>
<a class="reference external" href="https://aplwiki.com/wiki/Train#3-trains">Fork</a>
<a class="reference external" href="https://aplwiki.com/wiki/Dfns_workspace">Dfns Workspace</a>
<a class="reference external" href="https://aplwiki.com/wiki/Boolean#Boolean_functions">Boolean Functions</a>
<a class="reference external" href="https://en.wikipedia.org/wiki/Logical_conjunction">Logical Conjunction</a>
<a class="reference external" href="https://en.wikipedia.org/wiki/Logical_NOR">Logical Nor</a>
<a class="reference external" href="https://aplwiki.com/wiki/Train#Problems_caused_by_function-operator_overloading">Fork and Atop Problem</a>
<a class="reference external" href="https://xpqz.github.io/cultivations/Regex.html">Regular Expressions</a>
<a class="reference external" href="https://en.wikipedia.org/wiki/Intersection_(set_theory)">Intersection</a>
<a class="reference external" href="https://aplwiki.com/wiki/Dfn#Error-guards">Error Guard</a> <code class="docutils literal notranslate"><span class="pre">::</span></code>
<a class="reference external" href="https://aplwiki.com/wiki/Performance#Performant_usage">Performance</a>
<a class="reference external" href="http://dfns.dyalog.com/n_cmpx.htm">CMPX</a></p>
<p><strong>Reference:</strong>
<a class="reference external" href="http://archive.vector.org.uk/art10501480">Sixteen APL Amuse-Bouches</a> - #5
<a class="reference external" href="https://www.regular-expressions.info/">Learn Regular Expressions</a></p>
<p><strong>Transcript:</strong></p>
<p>Hello and welcome to this fourth APL Quest. Check APL Wiki for details. Today’s Quest is called ‘Keeping Things in Balance’. Here, we take a character vector and it has parentheses in it. We need to check whether the parentheses are balanced, so it looks like a normal mathematical expression, or whether things are wrong. Say we begin with closing parentheses that aren’t there, or we end with some open parenthesis.</p>
<p>Let’s get started. Let’s start by having a test data just to see how this works. So, we create a character vector, and let’s put in some expression there. For example, something like this: okay this is a balanced one.</p>
<p>And the approach we’re going to start off with today is that we’re going to find out where the depth of the parenthesis nesting changes, and there are a few different ways we can do that. Then later, we’ll move on to actually finding out whether or not the parentheses are balanced or not.</p>
<p>A very simple approach and a classic one in APL is to convert the input into a normalized form. So, we can look up every character in this test case, the indices of its characters in the open plan and closed paren, and APL does this that if an element isn’t found in a lookup array, then we get the next index. So, one and two are the open and close, and three is any character which wasn’t found.</p>
<p>Now, we need to map these to indicate when the parenthesis level changes. So, and we use this to index into a vector and we say when we have open parenthesis, then we increase the parenthesis level; when we have a closing pan, then we decrease the parenthesis level; and any other character we map to zero, as it doesn’t affect the level.</p>
<p>Let’s stack this together with original input. So, we’re going to mix the concatenation of the enclosures with the original, and we can see how when we have open parenthesis the parenthesis level increases, closing parenthesis decreases, and any other character leaves the parenthesis level unaffected.</p>
<p>We can make this into a function. Let’s call this the parenthesis depth changes using indexing, and so it’s going to take this formula. But there are other ways that we can do this. We can in a similar manner, but instead of lookup, we can do a comparison.</p>
<p>If we take the character vector consisting of these parentheses and do an outer product with the characters here, we get a table and we can do the same trick as before to stack up on top and we can see here that the first row of this Boolean matrix indicates whenever the parenthesis level increases and the second row indicates when it decreases, and then the other row is of course zero.</p>
<p>Then we can do this clever thing that we can subtract the bottom row from the top row. The top row minus the bottom row, that’s a vertical minus reduction, and that gives us the same thing. Now we need to stack them on top of each other. Now we get the same thing as before. So, this is a different way of doing it, and we can call this the parentheses depth changes using the outer product over outer product.</p>
<p>So we can even do this as a tacit function because it’s so simple and the argument is just the identity right there. But there are more ways we can do this. We can also do the two comparisons each by themselves. So let’s say we take the comparison to the left parenthesis and the comparison with the right parenthesis and put them next to each other. That gives us these two vectors. We could of course stack them on top of each other and then we get just like the other product.</p>
<p>But since we’re going to subtract them from each other we can just put the minus in between and that gives us the parenthesis depth changes right away. We can give this a name and we can again make it into a tested function because it’s really simple. So we can and it looks very nice as well symmetric like this.</p>
<p>So we can bind this to equal making equal equals and left parenthesis in a magnetic function and subtract the same thing. We can put the because equal is computed so we can put the argument on either side. I’d like to put it like this because it looks really cool. So this is the depth using a fork with the two outer tines equality to the two parenthesis and then subtracting the two from each other.</p>
<p>Now this is on a tiny little test case. Let’s get some real data that we can try this on and then let’s do some performance comparison before we move on to the second part of the problem because we haven’t solved the whole thing yet. We need to find out are they balanced or not. So for that, I’m going to copy in some functions from the defense workspace and we’re not going to use these functions other than just their source as example data. So there’s a turtle function, there’s a joy programming language interpreter, and then we need the comparison and performance comparison as well. We copy those from defense right and they are large functions.</p>
<p>These turtle enjoy but not really large enough, so let’s create some data. We have some data. I know that turtle has parentheses that are well balanced and joy has parenthesis that are not well balanced. I looked that up before. So this gives us these two test cases. Let’s call it yes and no and whether or not they are balanced. I’m going to take the source code of each one so the vector representation of each of turtle turtle and joy and then I’m going to make them a little bit bigger so we’re going to take that source code and reshape it using 100 times its current shape and this gives us some large test data. We can see here that y is a bit of a million and n is a couple of million so now we can compare them.</p>
<p>But instead of typing out the expressions with these three different functions let’s use an apl expression to generate the expressions that we’re going to time a little bit of meter programming here. So every function begins with a d and we concatenate that to each of these suffixes i o and f and then we concatenate each of those to the entire argument y so this gives us these three expressions and we can run cmpx on those and we can see that the df the one that just that is the fork just compares it to one parenthesis and the other parenthesis and subtracting them is by far the fastest one for these cases. And what if we do it on something that isn’t balanced and again interestingly enough here the i and the o are approximately the same speed but df still wins out. So this is the first part of the problem determining when the parenthesis level changes goes up and down.</p>
<p>Next, we’re going to use this to compute whether or not they’re actually balanced or not. So we can use df that was the fastest one on our test case that gives us these ones and zeros and now we have to think about what does it mean that it’s balanced. So there really two things to it, one is that when the whole input is finished when we reach the end we have to reach down to parenthesis level zero and when we go along we’re never allowed to dip below zero because that would mean that we have closed more parenthesis than we have opened.</p>
<p>So we want the running total of the parenthesis depth, that’s very simple we can do that with a scan and this is then the parenthesis depth. And we also want to know what is the left element whether or not it is zero, that would be the sum of them and that’s zero. So now we can just put together these two conditions, the first condition being that it is always true, it’s true for all that they are greater than or equal to zero in the running sum and also it has to be true that 0 equals the full sum. Let’s give this a name and we’ll call it ba because we’re using this and condition. Both this condition has to be true and this condition has to be true.</p>
<p>But we can also do it a different way, a little bit more succinct at least the first part. If we’re saying it has to be all true, that’s the end reduction that all of the elements have to be greater than or equal to zero. Now the parenthesis level can only change by one step at a time, there’s no double open parenthesis there’s only single open parenthesis and they can only go down one level.</p>
<p>So the first condition which is to check that we never reach a negative level, it would have to pass negative one in order to become negative. It might continue further on but it’s a sufficient check to see whether or not we have any negative ones.</p>
<p>So we can say negative one is a member of the running sum means it’s invalid and the second and then so now we’re doing it in reverse we’re using a negative conditions and similarly we have to say that 0 is different from the sum. These are things that are not allowed to be present and therefore if neither of them are present then our expression is well balanced. So instead of having an and we have to use a nor so we can call this balanced using nor.</p>
<p>Let’s compare the performance of these two and similarly we can create the expressions that we want. So we start off with ba and bn we could we can just spell it out since the only two of them bn and each one of them concatenated to the entire yd here so we have we haven’t assigned this yet we should go up and assign this so this is the depth for y and we should do the depth fun for n as well and then we can get these two expressions and cmpx on that and yeah it’s about the same.</p>
<p>You can do the same thing for the nose and that’s a bit faster and we can probably reason our way for that because in ba we did the comparison of everything in the running sum and then we check whether they’re all true whereas in bn we’re not doing any comparisons and for we’re not doing comparisons for all of the elements we just start looking for negative one and as soon as we hit any negative one we’re done. So the membership function will just terminate right there it doesn’t have to look through the entire array so in some cases that can be faster and so here bn in some cases can be faster than ba. And that means we can potentially put together a whole solution here based on these.</p>
<p>Then we can get these two expressions and cmpx on that and yeah it’s about the same you can do the same thing for the nose and that’s a bit faster and we can probably reason our way for that because in ba we did the comparison of everything in the running sum and then we check whether they’re all true.</p>
<p>Whereas in bn we’re not doing any comparisons and for we’re not doing comparisons for all of the elements we just start looking for negative one and as soon as we hit any negative one we’re done so the membership function will just terminate right there it doesn’t have to look through the entire array so in some cases that can be faster and so here bn in some cases can be faster than ba and that means we can potentially put together a whole solution here based on these.</p>
<p>We take the dfn from before and supply its results to bn, which should give us the answer. We can do f on each of y and n, which should give it one and zero, and that worked. We can also spell it out.</p>
<p>We can improve performance by breaking out the scan and picking out the right element from this scan, the cumulative sum, instead of using a new reduction. We break out the scan and glue these together with a bind operator. This is bns. We compare bn and bns, each one concatenated to the yd, and got a bit of a speed up. We can try it again with nd as well, and got a bit of a speed up there again.</p>
<p>We can put all of this together and have a final solution. We define f and take the definition from b and s. We apply this function, which is a fork, and then we want to apply this function, which is at a top. We have a fork as the right part, with two comparisons, and the scan of the subtraction as the middle part. This gives us the results.</p>
<p>As an alternative solution, we can use regular expressions. We start off by applying the function of intersection with the parenthesis, and then write a regular expression. We apply this on our test case and remove the parentheses. We do this until there are no more changes, and if the result is an empty character vector, that means it’s balanced. We can also use quad r, a feature added to apl, which is for replacements of plain text. We switch regex off and now we don’t need to escape the parentheses anymore because now it’s just plain text replace from these two parentheses to nothing so let’s call this well it’s not really regular expressions anymore it’s replace but well no regex i guess.</p>
<p>We can try implementing the method we are thinking of in APL and that could give better performance. To find the open and close parenthesis, we can use the find function. We need to remove all characters that are not parentheses first and compare it with an empty character vector. We can do a rotate so we can do both the mask that we just computed and OR when it’s rotated one step and this indicates both the opening and the closing parentheses. We can flip the OR to a NOR and this gives us a mask indicating just the characters we want to keep.</p>
<p>We can put all of this together, and use the find function to get a one and zero. We don’t need to repeat the process of removing the parentheses, but instead, we need to repeat squeezing away the open and close parentheses. We can do the same thing with powermatch and then compare it to an empty character vector.</p>
<p>We can put it all together and glue this together again. This is using find. We can try to compare the performance of these. We have RE and RE0 and FI and we’re comparing them to Y and N. We can see that the regular expression engine is very heavy weight, and it’s much faster to do it either with replace without regex or implementing it ourselves.</p>
<p>Finally, we can kind of circumvent the problem, because the same kind of parenthesis matching is happening in mathematics and programming languages as well. We can leverage this and use the same thing when APL evaluates an expression. We can start off using the braces and doing the same mapping as before.</p>
<p>We can wrap this in a DFN, put in an error guard, and if we don’t get an error, we need to apply this function in a way that won’t error. We can take this function and reduce over a scalar or one element vector, and APL will never actually use the function.</p>
<p>Finally, we can use the nesting depth of parentheses and use a stranding of parenthesis to try and parse the expression. We can flatten it in case it’s nested, and see whether or not that works.</p>
<p>These are just some fun solutions of abusing the system.</p>
<p>Thank you very much for watching</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "jgordini/apl-quest-notes",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./apl-quest/2013/old"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By jgordini
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>